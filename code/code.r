## ---- include = FALSE---------------------------------------------------------
options(encoding = 'UTF-8') # 为了正确显示中文
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  cache = TRUE
)


## -----------------------------------------------------------------------------
pts = read.csv('data/20040101_PM25_and_species.csv')
head(pts)


## ----warning=FALSE------------------------------------------------------------
library(raster)


## -----------------------------------------------------------------------------
rs = raster::rasterFromXYZ(pts)


## -----------------------------------------------------------------------------
plot(rs)


## -----------------------------------------------------------------------------
crs(rs)


## -----------------------------------------------------------------------------
crs(rs) <- CRS('+init=EPSG:4326')


## -----------------------------------------------------------------------------
crs(rs)


## -----------------------------------------------------------------------------
writeRaster(rs,"result/rs.tif", overwrite = T)


## -----------------------------------------------------------------------------
head(pts,1)


## -----------------------------------------------------------------------------
rm(list = ls())


## -----------------------------------------------------------------------------
dat = brick('result/rs.tif')


## -----------------------------------------------------------------------------
mypt = data.frame(lon = 116.35, lat = 39.45)


## -----------------------------------------------------------------------------
mypt = SpatialPoints(mypt, proj4string=CRS("+proj=longlat +datum=WGS84"))
class(mypt)


## -----------------------------------------------------------------------------
extract(dat, mypt)


## -----------------------------------------------------------------------------
mypt2 = data.frame(lon = c(116.35, 115.75, 116.25), lat = c(39.45, 39.55, 39.55))
mypt2


## -----------------------------------------------------------------------------
mypt2 = SpatialPoints(mypt2, proj4string=CRS("+proj=longlat +datum=WGS84"))


## -----------------------------------------------------------------------------
extract(dat, mypt2)


## -----------------------------------------------------------------------------
rm(list = ls())


## ----warning=FALSE------------------------------------------------------------
library(raster)
mync = brick('data/cru10min30_tmp.nc')


## -----------------------------------------------------------------------------
dim(mync)


## -----------------------------------------------------------------------------
mypt = data.frame(lon = 116.35, lat = 39.45)
mypt = SpatialPoints(mypt, proj4string=CRS("+proj=longlat +datum=WGS84")) # 将mypt转换为sp


## -----------------------------------------------------------------------------
extract(mync, mypt)


## -----------------------------------------------------------------------------
dim(extract(mync, mypt))


## -----------------------------------------------------------------------------
mypt2 = data.frame(lon = c(116.35, 115.75, 116.25), lat = c(39.45, 39.55, 39.55))
mypt2 = SpatialPoints(mypt2, proj4string=CRS("+proj=longlat +datum=WGS84")) # 将mypt2转换为sp

extract(mync, mypt2)


## -----------------------------------------------------------------------------
dim(extract(mync, mypt2))


## -----------------------------------------------------------------------------
rm(list = ls())


## -----------------------------------------------------------------------------
files = c('result/rs.tif', 'result/rs.tif')


## -----------------------------------------------------------------------------
library(terra)
r <- terra::rast(files)


## -----------------------------------------------------------------------------
mypt2 = data.frame(lon = c(116.35, 115.75, 116.25), lat = c(39.45, 39.55, 39.55))


## -----------------------------------------------------------------------------
e <- terra::extract(r, mypt2)
e


## -----------------------------------------------------------------------------
files2 = c('data/cru10min30_tmp.nc', 'data/cru10min30_tmp.nc')
r2 <- terra::rast(files2)
e2 <- terra::extract(r2, mypt2)
e2


## -----------------------------------------------------------------------------
rm(list = ls())


## -----------------------------------------------------------------------------
nc_file = 'data/cru10min30_tmp.nc'

nc_rast = terra::rast(nc_file)
nc_raster=raster::raster(nc_file)


## -----------------------------------------------------------------------------
dim(nc_rast)
dim(nc_raster)


## ----eval=FALSE---------------------------------------------------------------
#> terra::writeRaster(nc_rast, filename = 'result/多层nc_to_tif.tif', overwrite = T)


## -----------------------------------------------------------------------------
multi_layer_tif = terra::rast('result/多层nc_to_tif.tif')
dim(multi_layer_tif)


## -----------------------------------------------------------------------------
mypt2 = data.frame(lon = c(116.35, 115.75, 116.25), lat = c(39.45, 39.55, 39.55))

extract(multi_layer_tif, mypt2)




## ----include=FALSE------------------------------------------------------------
knitr::purl("README.Rmd", 'code/code.r')

